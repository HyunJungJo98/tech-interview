# CSRF란

Cross Site Request Forgery(사이트 간 요청 위조)

웹 어플리케이션 취약점 중 하나로, 공격자가 희생자의 의도와 무관하게 희생자의 권한을 도용하여 특정 웹 사이트의 기능을 실행하게 하는 공격을 말한다.

# 예시

사용자의 SNS 계정으로 광고성 글 올리기

# 실행 조건

- 사용자가 해커가 만든 피싱 사이트에 접속한다.
- 위조 요청을 보낼 서비스에 사용자가 로그인이 되어있다.

보통 자동 로그인을 해둔 경우 이런 피싱 사이트에 접속하게 되면서 피해를 입는 경우가 많다. 또한 해커가 XSS 공격을 성공시킨 사이트라면 피싱 사이트가 아니더라도 CSRF 공격이 이루어질 수 있다.

# 실행 과정

![image](https://github.com/user-attachments/assets/2413e433-1d1a-4050-a0e8-b4185d397007)

1. 희생자가 위조 요청을 보낼 서비스에 로그인한 상태로 피싱 사이트에 접속한다.
2. 희생자가 피싱 사이트에 접속하면 피싱 사이트에서 희생자로 가장하여 요청을 위조해 전송한다.
3. 위조 요청을 받은 사이트는 해당 요청에 대한 응답을 하게 되고, 이로 인해 희생자가 의도하지 않은 행동이 실행된다.

   ex) 광고글 작성, 로그아웃

# 대응 방법

크게 세 가지가 있다.

1. **CAPCHA 사용** : 이미지를 보여주고 그 이미지에 해당하는 문자/숫자/그림이 아니라면 요청을 거부한다.
2. **Referrer 검증법** : 요청이 들어올 때 백엔드에서 request header에 담겨있는 referrer 값을 확인하여 같은 도메인에서 보내온 요청인지 검증한다. 대부분의 경우는 이 방법으로 공격을 방어할 수 있다.

   하지만 동일 사이트 내에서 XSS 취약점이 발견된다면 이를 통해 CSRF 공격을 실행할 수 있다. 이는 페이지 단위까지 쪼개어 도메인을 검증하는 방법으로 페이지 간 CSRF 공격을 방어할 수 있다.

3. **CSRF Token 사용** : 사용자의 세션에 임의의 값을 저장하여 모든 요청마다 그 값을 포함하여 전송한다. 요청이 들어올 때마다 백엔드에서 세션에 저장된 값과 요청으로 전송된 값이 일치하는지 검증한다.

   XSS를 통한 CSRF 공격에 취약하다.

# 참고

- [https://github.com/gyoogle/tech-interview-for-developer/blob/master/Web/CSRF %26 XSS.md](https://github.com/gyoogle/tech-interview-for-developer/blob/master/Web/CSRF%20%26%20XSS.md)
- https://tibetsandfox.tistory.com/11
